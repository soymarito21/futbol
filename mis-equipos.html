<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mis Equipos Guardados</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #0a0a0a;
    color: white;
    margin: 0; padding: 2rem;
  }
  h1 {
    color: #00ff88;
    text-align: center;
  }
  .team {
    background: #1a1a1a;
    border-radius: 8px;
    margin: 1rem auto;
    max-width: 600px;
    padding: 1rem;
  }
  .team-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  button {
    background: #00ff88;
    border: none;
    border-radius: 5px;
    padding: 5px 10px;
    cursor: pointer;
    margin-left: 5px;
  }
  button.delete {
    background: #ff4444;
  }
  .player {
    margin-left: 10px;
  }
  #user-info {
    text-align: center;
    margin-bottom: 20px;
  }
  #btnLogout {
    background: red;
    color: white;
    width: auto;
    padding: 5px 10px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 5px;
  }
</style>
</head>
<body>
<h1>Mis Equipos Guardados</h1>
<div id="user-info">
  <button id="btnLogin">Iniciar sesi√≥n con Google</button>
</div>

<div id="teamsContainer"></div>

<script type="module">
  import { auth, provider, signInWithPopup, signOut, onAuthStateChanged, db, collection, getDocs, doc, updateDoc, deleteDoc, query, where } from './firebase.js';

  const userInfo = document.getElementById('user-info');
  const btnLogin = document.getElementById('btnLogin');
  const teamsContainer = document.getElementById('teamsContainer');

  let currentUser = null;

  btnLogin.onclick = async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      currentUser = result.user;
      loadTeams();
    } catch (e) {
      alert("Error al iniciar sesi√≥n: " + e.message);
    }
  };

  onAuthStateChanged(auth, user => {
    if (user) {
      currentUser = user;
      userInfo.innerHTML = `
        <p>üë§ Hola, ${user.displayName}</p>
        <button id="btnLogout">Cerrar sesi√≥n</button>
      `;
      document.getElementById('btnLogout').onclick = () => signOut(auth);
      loadTeams();
    } else {
      currentUser = null;
      userInfo.innerHTML = `<button id="btnLogin">Iniciar sesi√≥n con Google</button>`;
      document.getElementById('btnLogin').onclick = btnLogin.onclick;
      teamsContainer.innerHTML = '';
    }
  });

  async function loadTeams() {
    if (!currentUser) return;
    teamsContainer.innerHTML = '<p>Cargando equipos...</p>';
    try {
      const q = query(collection(db, "teams"), where("userId", "==", currentUser.uid));
      const querySnapshot = await getDocs(q);
      if (querySnapshot.empty) {
        teamsContainer.innerHTML = '<p>No tienes equipos guardados.</p>';
        return;
      }
      teamsContainer.innerHTML = '';
      querySnapshot.forEach(docSnap => {
        const team = docSnap.data();
        const teamDiv = document.createElement('div');
        teamDiv.className = 'team';
        teamDiv.innerHTML = `
          <div class="team-header">
            <strong>${team.teamName}</strong>
            <div>
              <button onclick="editTeam('${docSnap.id}')">‚úèÔ∏è Editar</button>
              <button class="delete" onclick="deleteTeam('${docSnap.id}')">üóëÔ∏è Borrar</button>
            </div>
          </div>
          <div>
            ${team.players.map(p => `<div class="player">${p.name} | ${p.nation} | ${p.position} | ‚≠ê ${p.rating}</div>`).join('')}
          </div>
        `;
        teamsContainer.appendChild(teamDiv);
      });
    } catch (e) {
      teamsContainer.innerHTML = `<p>Error cargando equipos: ${e.message}</p>`;
    }
  }

  window.editTeam = async (id) => {
    // Para editar, simplemente abrimos editor.html con el id como query param
    window.location.href = `editor.html?teamId=${id}`;
  };

  window.deleteTeam = async (id) => {
    if (!confirm('¬øSeguro que quieres borrar este equipo?')) return;
    try {
      await deleteDoc(doc(db, "teams", id));
      alert('Equipo borrado');
      loadTeams();
    } catch (e) {
      alert('Error borrando equipo: ' + e.message);
    }
  };
</script>
</body>
</html>



